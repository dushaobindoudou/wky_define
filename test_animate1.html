<!DOCTYPE html>
<head>
    <title>测试</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="script/jquery.min.js"></script>
    <script type="text/javascript" src="script/jquery.easing.js"></script>
    <script type="text/javascript" src="script/popup.js"></script>
    <script type="text/javascript" src="script/roateImg.js"></script>
    <script type="text/javascript" src="script/drag.js"></script>
    <script type="text/javascript" src="script/define.js"></script>
    <script type="text/javascript" src="script/Sly.js"></script>
    <script type="text/javascript" src="script/clickDespatcher.js"></script>
    <script type="text/javascript" src="script/aiolia.js"></script>
</head>
<body style="overflow:auto; margin:0; padding:0;">
    <div style="border:1px solid red; height:498px; position:relative; margin-top:0;">
        <div id="t1" style="background:#34edec; width:300px; height:200px;">
            线性运动
        </div>
		<div style="with:30px; bottom:0; height:25px; width:100%; border:1px solid green; position:absolute;">
			<input type="button" id="run" value="运行" />
		</div>
    </div>
    <div id="stage" style="background:green; width:990px; height:480px; position:absolute; left:10px; top:500px; overflow:hidden;">
        <div id="a1" style="position:absolute; background:#89cded; width:300px; height:200px; left:0;top:0;">
            开始我们的教程
        </div>
        <div id="a2" style="position:absolute; background:#89deee; width:200px; height:250px;left:310px; top:0;">
        </div>
        <div id="a3" style="position:absolute; background:#aecded; width:250px; height:100px; left:520px; top:0;">
        </div>
        <div id="a4" style="position:absolute; background:#fcdeee; width:300px; height:100px; left:0; top:210px;">
        </div>
        <div id="a5" style="position:absolute; background:#789345; width:180px; height:140px;left:0; top:320px;">
        </div>
        <div id="a6" style="position:absolute; background:#dffeac; width:460px; height:100px;left:310px; top:260px;">
        </div>
        <div id="a7" style="position:absolute; background:#4455ff; width:110px; height:140px;left:190px; top:320px; ">
        </div>
        <div id="a8" style="position:absolute; background:#ee4567; width:300px; height:90px;left:310px; top:370px;">
        </div>
        <div id="a9" style="position:absolute; background:#ecaa34; width:250px; height:140px; top:110px; left:520px;">
        </div>
        <div id="a10" style="position:absolute; background:#ceaaff; width:150px; height:90px; top:370px; left:620px;">
        </div>
        <div id="a11" style="position:absolute; background:#dffeac; width:100px; height:50px;top:0; left:780px;">
        </div>
        <div id="a12" style="position:absolute; background:#4455ff; width:100px; height:80px;top:60px; left:780px;">
        </div>
        <div id="a13" style="position:absolute; background:#ee4567; width:100px; height:50px; top:150px; left:780px;">
        </div>
        <div id="a14" style="position:absolute; background:#ecaa34; width:100px; height:160px;top:210px; left:780px;">
        </div>
        <div id="a15" style="position:absolute; background:#ceddff; width:100px; height:80px;top:380px; left:780px;">
        </div>
        <div id="a16" style="position:absolute; background:#ceddff; width:100px; height:80px;top:580px; left:500px;">
        </div>
        <div id="a17" style="position:absolute; background:#ceaaff; width:100px; height:80px;top:580px; left:600px;">
        </div>
        <div id="a18" style="position:absolute; background:#ceeeff; width:100px; height:80px;top:580px; left:700px;">
        </div>
        <div class="control" style="float:right;">
            <input id="begin-animate" type="button" value="开始" /><input id="end-animate" type="button" value="结束" />
        </div>
    </div><script type="text/javascript">
        //轨迹测试
        var pp = stageCollection.addStage([{
            from: 0,
            to: 100,
            pAxisBegin: 2,
            transfroms: [{
                ele: "#a16",
                totalSteps: 100,
                easing: "easeOutBack",
                fun: "circle",
                autoRun: true,
                args: [200, {
                    x: 580,
                    y: 500
                }]
            }, {
                ele: "#a17",
                totalSteps: 100,
                easing: "easeOutBack",
                fun: "circle",
                args: [250, {
                    x: 580,
                    y: 600
                }]
            }, {
                ele: "#a18",
                totalSteps: 100,
                easing: "easeOutBack",
                fun: "circle",
                args: [150, {
                    x: 580,
                    y: 700
                }]
            }]
        }, {
            from: 0,
            to: 100,
            pAxisBegin: 10,
            transfroms: [{
                ele: "#a1",
                fun: "line",
                args: [1, {
                    x: 320,
                    y: 320
                }, {
                    x: 0,
                    y: 0
                }, "y"]
            }, {
                ele: "#a1",
                fun: "fade",
                easing: "easeInBack",
                args: [0, 1]
            }, {
                ele: "#a1",
                fun: "rotate",
                args: [0, 360]
            }]
        }, {
            from: 0,
            to: 100,
            pAxisBegin: 11,
            transfroms: [{
                ele: "#a2",
                fun: "line",
                args: [0.68, {
                    x: 780,
                    y: 320
                }, {
                    x: 310,
                    y: 0
                }, "y"]
            }, {
                ele: "#a2",
                fun: "fade",
                args: [0, 1]
            }, {
                ele: "#a2",
                fun: "rotate",
                easing: "easeInBounce",
                args: [60, 180]
            }]
        }, {
            from: 410,
            to: 200,
            pAxisBegin: 12,
            transfroms: [{
                ele: "#a3",
                fun: "line",
                args: [-0.611, {
                    x: 0,
                    y: 320
                }, {
                    x: 520,
                    y: 0
                }, "y"]
            }, {
                ele: "#a3",
                fun: "fade",
                args: [1, 0.4]
            }, {
                ele: "#a3",
                fun: "rotate",
                args: [80, 180]
            }]
        }, {
            from: 420,
            to: 480,
            pAxisBegin: 13,
            transfroms: [{
                ele: "#a11",
                fun: "line",
                args: [-.410, {
                    x: 0,
                    y: 320
                }, {
                    x: 780,
                    y: 0
                }, "y"]
            }, {
                ele: "#a11",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 400,
            to: 600,
            pAxisBegin: 14,
            transfroms: [{
                ele: "#a7",
                fun: "zoom",
                args: [{
                    width: 110,
                    height: 140
                }, {
                    width: 300,
                    height: 300
                }]
            }, {
                ele: "#a7",
                fun: "fade",
                args: [0, 1]
            }, {
                ele: "#a7",
                fun: "rotate",
                args: [40, 180]
            }]
        }, {
            from: 400,
            to: 600,
            pAxisBegin: 31,
            transfroms: [{
                ele: "#a7",
                fun: "zoom",
                args: [{
                    width: 300,
                    height: 300
                }, {
                    width: 110,
                    height: 140
                }]
            }]
        }, {
            from: 150,
            to: 200,
            pAxisBegin: 15,
            transfroms: [{
                ele: "#a12",
                fun: "line",
                args: [-.331, {
                    x: 0,
                    y: 320
                }, {
                    x: 780,
                    y: 60
                }, "y"]
            }, {
                ele: "#a12",
                fun: "fade",
                args: [0, 1]
            }, {
                ele: "#a12",
                fun: "rotate",
                args: [80, 180]
            }]
        }, {
            from: 210,
            to: 240,
            pAxisBegin: 16,
            transfroms: [{
                ele: "#a5",
                fun: "line",
                args: [-.410, {
                    x: 780,
                    y: 0
                }, {
                    x: 0,
                    y: 320
                }, "y"]
            }, {
                ele: "#a5",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 210,
            to: 240,
            pAxisBegin: 17,
            transfroms: [{
                ele: "#a7",
                fun: "line",
                args: [-.559, {
                    x: 780,
                    y: -10
                }, {
                    x: 190,
                    y: 320
                }, "y"]
            }, {
                ele: "#a17",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 250,
            to: 340,
            pAxisBegin: 18,
            transfroms: [{
                ele: "#a10",
                fun: "line",
                args: [.769, {
                    x: 60,
                    y: -30
                }, {
                    x: 620,
                    y: 370
                }, "y"]
            }, {
                ele: "#a10",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 19,
            transfroms: [{
                ele: "#a8",
                fun: "line",
                args: [.7755, {
                    x: -180,
                    y: -10
                }, {
                    x: 310,
                    y: 370
                }, "y"]
            }, {
                ele: "#a8",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 6,
            transfroms: [{
                ele: "#a15",
                fun: "line",
                args: [.513, {
                    x: 20,
                    y: -10
                }, {
                    x: 780,
                    y: 380
                }, "x"]
            }, {
                ele: "#a15",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 20,
            transfroms: [{
                ele: "#a6",
                fun: "line",
                args: [.823, {
                    x: -30,
                    y: -20
                }, {
                    x: 310,
                    y: 260
                }, "y"]
            }, {
                ele: "#a6",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 21,
            transfroms: [{
                ele: "#a4",
                fun: "line",
                args: [-.282, {
                    x: 780,
                    y: -10
                }, {
                    x: 0,
                    y: 210
                }, "y"]
            }, {
                ele: "#a4",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 9,
            transfroms: [{
                ele: "#a9",
                fun: "line",
                easing: "easeInElastic",
                args: [-.754, {
                    x: -10,
                    y: 510
                }, {
                    x: 520,
                    y: 110
                }, "y"]
            }, {
                ele: "#a9",
                easing: "easeInBounce",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 23,
            transfroms: [{
                ele: "#a13",
                fun: "line",
                easing: "easeInCubic",
                args: [-.455, {
                    x: -10,
                    y: 510
                }, {
                    x: 780,
                    y: 150
                }, "x"]
            }, {
                ele: "#a12",
                fun: "line",
                stepDistance: 14,
                args: [-.455, {
                    x: -10,
                    y: 510
                }, {
                    x: 7800,
                    y: 1500
                }, "x"]
            }, {
                ele: "#a13",
                fun: "fade",
                args: [0, 1]
            }]
        }, {
            from: 300,
            to: 370,
            pAxisBegin: 24,
            transfroms: [{
                ele: "#a14",
                fun: "line",
                easing: "easeInBounce",
                args: [.455, {
                    x: 100,
                    y: -100
                }, {
                    x: 780,
                    y: 210
                }, "y"]
            }, {
                ele: "#a14",
                fun: "fade",
                args: [0, 1]
            }]
        }]);
        (function(){
            var dom = $(document);
            var that = pp;
            //上下左右，鼠标滚轮
            dom.bind("DOMMouseScroll", function(event, dalt){
                if (event.detail) {
                    delta = -event.detail / 3;
                }
                if (delta < 0) {
                    //向下
                    pp.next();
                    console.log(11);
                }
                else {
                    //向上
                    pp.prev();
                    console.log(22);
                }
            });
            //for ie
            dom.bind("mousewheel", function(event){
                var delta = 0;
                if (event.wheelDelta) {
                    delta = event.wheelDelta / 120;
                }
                if (delta < 0) {
                    //向下
                    //road += 1;
                    
                    pp.next();
                }
                else {
                    //向上
                    pp.prev();
                }
            });
            //绑定键盘事件
            $(window).bind("keypress", function(){
            });
            //todo:win size
        })()
        
        var tmpCount = 0;
        var incrace = true;
        
        var iv = null;
        
        $("#begin-animate").click(function(){
            if (iv) {
                return;
            }
            iv = setInterval(function(){
                if (incrace) {
                    tmpCount++;
                    pp.next();
                }
                else {
                    tmpCount--;
                    pp.prev();
                }
                if (tmpCount > 100) {
                    incrace = false;
                }
                if (tmpCount < 0) {
                    incrace = true;
                }
            }, 100);
        });
        $("#end-animate").click(function(){
            if (iv) {
                clearInterval(iv);
                iv = null;
            }
            
        });
        
        
        var insertClosestVal = function(ary, val){
            if (!ary.length) {
                ary.push(val);
            }
            var cur = Math.ceil(len / 2);
            var prev = -1;
            var nxt = -1;
            var cv = 0;
            var pv = 0;
            var nv = 0;
            var isStop = false;
            while (isStop) {
                prev = cur - 1;
                nxt = cur + 1;
                cv = ary[cur];
                pv = ary[prev];
                nv = ary[nxt];
                
                var msRes = Math.abs(cv - val) - Math.abs(prev - val);
                if (msRes < 0) {
                    cur = cur - parseInt(cur / 2, 10);
                }
                else 
                    if (msRes > 0) {
                        cur = cur + parseInt(cur / 2, 10);
                    }
                    else {
                        if (cv - val > 0) {
                            return cur - 1;
                        }
                        else {
                            return cur;
                        }
                    }
                
                
                isStop = Math.abs(cur - prev) < 1 || Math.abs(cur - nxt) < 1;
            }
        }
        /*
         *
         * 思路查找找到一个离自己最近的数
         * 比较前一个，后一个的距离
         *
         *
         */
        var binarySearchC = function(ary, val){
            var aryTolLen = ary.length;
            var len = aryTolLen;
            var pos = Math.ceil(len / 2) - 1;
            var prvPos = pos - 1;
            var nxtPos = pos + 1;
            var prvVal = 0;
            var nxtVal = 0;
            var temp = 0;
            var prvDVal = 0;
            var nxtDVal = 0;
            var curDVal = 0;
            var dirVal = 0;
            var theRes = -2;
            var pnd = 0;
            while (1) {
                tmp = ary[pos];
                len = parseInt(len / 2);
                prvVal = ary[prvPos];
                nxtVal = ary[nxtPos];
                if (tmp == val) {
                    //左右无所谓啦
                    return pos;
                }
                prvDVal = Math.abs(prvVal - val);
                nxtDVal = Math.abs(nxtVal - val);
                curDVal = Math.abs(tmp - val);
                pnd = prvDVal - nxtDVal;
                if (pnd < 0) {
                    //向后移动
                    pos = pos - Math.ceil(len / 2);
                    pos = pos < 0 ? 0 : pos;
                    prvPos = pos - 1 < 0 ? 0 : pos - 1;
                    nxtPos = pos + 1;
                    dirVal = prvDVal;
                }
                else 
                    if (pnd > 0) {
                        //向前
                        pos = pos + Math.ceil(len / 2);
                        prvPos = pos - 1;
                        nxtPos = (pos + 1 > aryTolLen - 1) ? aryTolLen : pos + 1;
                        dirVal = nxtDVal;
                    }
                    else {
                        //比较当前是左边还是右边
                        return tmp >= val ? pos - 1 : pos;
                    }
                if (len <= 0) {
                    if (prvDVal >= nxtDVal) {
                        if (curDVal >= nxtDVal) {
                            theRes = nxtPos;
                        }
                        else {
                            theRes = pos;
                        }
                    }
                    else {
                        if (curDVal >= prvDVal) {
                            theRes = prvPos;
                        }
                        else {
                            theRes = pos;
                        }
                    }
                    //console.log(theRes);
                    return ary[theRes] >= val ? theRes - 1 : theRes;
                }
            }
        }
        /*
         *
         * 根据二分查找找到最近的值 然后向左看，向右看找到自己的位置
         *
         */
        var binarySearch = function(ary, val){
            var al = ary.length;
            var len = al;
            var pos = parseInt(len / 2);
            var tmp = 0;
            while (1) {
                tmp = ary[pos];
                len = parseInt(len / 2);
                if (tmp > val) {
                    //left
                    if (len != 1) {
                        pos = pos - parseInt(len / 2);
                    }
                    else {
                        pos = pos - 1;
                    }
                    if (len < 0) {
                        //没找到
                        break;
                    }
                    console.log("前");
                }
                else 
                    if (tmp < val) {
                        //right
                        if (len != 1) {
                            pos = pos + parseInt(len / 2);
                        }
                        else {
                            pos = pos + 1;
                        }
                        if (pos >= al) {
                            break;
                        }
                        console.log("后");
                    }
                    else {
                        //找到了值
                        return pos;
                    //break;
                    }
                
                if (len <= 0) {
                    //没有找到值
                    //return pos;
                    break;
                }
            }
            //如果没有找到，看看四周
            var current = ary[pos];
            if (current < val) {
                pos = pos + 1;
            }
            return pos;
        }
        
        //todo:去重复问题
        var sy = [3, 10];
        var p = binarySearch(sy, 40);
        console.log(sy);
        console.log(p + ":" + sy[p]);
        
        
        var res = Sly.search("#di div.sp div");
        
        var cd = new ClickDespatcher(180, [function(){
            alert("click once");
        }, function(){
            alert("cilck double");
        }, function(){
            alert("手真快！")
        }, function(){
            alert("神人啊！");
        }, function(){
            alert("五连击！");
        }
        ]);
        
        $("#tv").click(function(){
            cd.addCount();
            
        });
        
        var bkExtend = function(){
            var args = arguments;
            if (args.length == 1) 
                args = [this, args[0]];
            for (var prop in args[1]) 
                args[0][prop] = args[1][prop];
            return args[0];
        };
        function bkClass(){
        }
        
        bkClass.prototype.construct = function(){
        };
        
        bkClass.extend = function(def){
            var classDef = function(){
                if (arguments[0] !== bkClass) {
                    return this.construct.apply(this, arguments);
                }
            };
            var proto = new this(bkClass);
            bkExtend(proto, def);
            classDef.prototype = proto;
            classDef.extend = this.extend;
            return classDef;
        };
        
        var sr = bkClass.extend({
            sp: "123"
        });
        var s = new sr({
            ss: "122"
        });
        s;
        var getStyle = function(ele, pro){
            var ownerDoc = ele.ownerDocument;
            if (ownerDoc.defaultView && ownerDoc.defaultView.getComputedStyle) {
                var styles = ownerDoc.defaultView.getComputedStyle(ele, null);
                if (styles) {
                    return styles[pro] || styles.getPropertyValue(pro);
                }
            }
            if (ele.currentStyle) {
                var styles = ele.currentStyle;
                return styles[pro];
            }
            return ele.style[pro];
        }
        
        
        
        var coo = deskPopup.addPopup({
            css: {
                width: "500px",
                height: "300px",
                color: "#ffffff",
                top: "0"
            },
            animateType: "top-bottom",
            popupId: "2-3",
            isKeepHold: false,
            content: $("#video").show()
        });
        var startCss = {
            left: ($(window).width() - 500) / 2,
            top: -300
        }, endCss = {
            top: ($(window).height() - 300) / 2,
            opacity: "0.7"
        }
        $("#di").click(function(){
            deskPopup.getPopup("2-3") &&
            deskPopup.getPopup("2-3").releaseHold();
        });
        $("#video").delegate("span.sure", "click", function(){
            var endCss = {
                top: -300
            };
            deskPopup.getPopup("2-3") &&
            deskPopup.getPopup("2-3").releaseHold();
            
        });
        var test = $("#test");
        
        test.click(function(){
            //dragable({
            //ele: $("#dg")
            //})
        
        });
        $(document).keypress(function(evt){
            if (evt.keyCode == 13) {
                console.log("sfdsad");
            }
            
        });
        wky_define("wky.base.core", function(core){
            var isAnimate = function(){
                alert("isAnimating");
            }
            return {
                varName: "isAnimate",
                varVal: isAnimate
            }
        });
        wky_define("wky.base.core", function(core){
        
            var isAnimate = function(){
                alert("isAnimating");
            }
            return {
                varName: "animatings",
                varVal: isAnimate
            }
            
        });
        wky_define("wky.base.ajax", function(core){
        
            var isAnimate = function(){
                alert("isAnimatingasdfasdfas");
            }
            return {
                varName: "animatings",
                varVal: isAnimate
            }
            
        });
        //$('#di')[0].innerHTML = '<!--<![endif]--><!--[if gte mso 10]>-->';
        //$('div').eq(0).html('<!--<![endif]--><!--[if gte mso 10]>-->');
    </script>
</body>
